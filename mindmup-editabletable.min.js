$.fn.editableTableWidget=function(e){"use strict";return $(this).each(function(){var t=function(){var e=$.extend({},$.fn.editableTableWidget.defaultOptions);return e},n=$.extend(t(),e),r=37,i=38,s=39,o=40,u=13,a=27,f=9,l=$(this),c={ntext:n.editors.ntext.css("position","absolute").hide().appendTo(l.parent()),ttext:n.editors.ttext.css("position","absolute").hide().appendTo(l.parent()),vtext:n.editors.ttext.css("position","absolute").hide().appendTo(l.parent()),date:n.editors.date.css("position","absolute").hide().appendTo(l.parent()).datepicker({format:"dd-M-yyyy"}),select:n.editors.select.css("position","absolute").hide().appendTo(l.parent())},h=null,p=null,d=function(){var e=p.attr("data-edit-type");if(e==null||typeof e=="undefined"){e="ttext"}else if(e.substring(0,6)=="select"){e="select"}return e},v=function(e){p=l.find("td:focus");if(p.length){var t=d();if(t=="date"){c["date"].datepicker("update",p.text())}else if(t=="select"){var r=window[p.attr("data-edit-type").substring(7)];var i=c.select;i.empty();$.each(r,function(e,t){i.append($("<option>",{value:e}).text(t))})}h=c[t];h.val(p.text()).removeClass("error").show().offset(p.offset()).css(p.css(n.cloneProperties)).width(p.width()).height(p.height()).focus();if(e){h.select()}}},m=function(){var e=h.val(),t=$.Event("change"),n;if(p.text()===e||h.hasClass("error")){return true}n=p.html();var r=d();if(r=="vtext"){if(e!==""){var i=numeral(e);e=i.format("0,0")}}p.text(e).trigger(t,e);if(t.result===false){p.html(n)}},g=function(e,t){if(t===s){return e.next("td")}else if(t===r){return e.prev("td")}else if(t===i){return e.parent().prev().children().eq(e.index())}else if(t===o){return e.parent().next().children().eq(e.index())}return[]};$.each(c,function(e,t){t.blur(function(){m();h.hide()}).keydown(function(e){if(e.which===u){m();h.hide();p.focus();e.preventDefault();e.stopPropagation()}else if(e.which===a){h.val(p.text());e.preventDefault();e.stopPropagation();h.hide();p.focus()}else if(e.which===f){p.focus()}else if(this.selectionEnd-this.selectionStart===this.value.length){var t=g(p,e.which);if(t.length>0){t.focus();e.preventDefault();e.stopPropagation()}}}).on("input paste",function(){var e=$.Event("validate");p.trigger(e,h.val());if(e.result===false){h.addClass("error")}else{h.removeClass("error")}}).on("changeDate",function(e){p.text(e.format());h.datepicker("hide")})});l.on("click keypress dblclick",v).css("cursor","pointer").keydown(function(e){var t=true,n=g($(e.target),e.which);if(n.length>0){n.focus()}else if(e.which===u){v(false)}else if(e.which===17||e.which===91||e.which===93){v(true);t=false}else{t=false}if(t){e.stopPropagation();e.preventDefault()}});l.find("td").prop("tabindex",1);$(window).on("resize",function(){if(h==null){return}if(h.is(":visible")){h.offset(p.offset()).width(p.width()).height(p.height())}})})};$.fn.editableTableWidget.defaultOptions={cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right"],editors:{ntext:$('<input type="number" class="text-right">'),ttext:$('<input type="text">'),vtext:$('<input type="text">'),date:$('<input data-provide="datepicker">'),select:$("<select>")},editor:null,active:null}